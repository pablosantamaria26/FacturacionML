<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Mercado Limpio PRO</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ==========================================
           SISTEMA DE TEMAS (Claro / Oscuro / Gladiador)
           ========================================== */
        :root {
            --bg-app: #f2f2f7;
            --bg-card: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --accent: #2563eb;
            --accent-text: #ffffff;
            --dock-bg: rgba(255, 255, 255, 0.85);
            --font-head: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] {
            --bg-app: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --accent: #3b82f6;
            --accent-text: #ffffff;
            --dock-bg: rgba(30, 41, 59, 0.85);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        [data-theme="gladiator"] {
            --bg-app: #120a0a; /* Oscuro profundo romano */
            --bg-card: #241414; /* Rojo m√°rmol muy oscuro */
            --text-main: #fcd34d; /* Dorado Oro */
            --text-muted: #d6d3d1; /* Piedra */
            --border-color: #78350f; /* Bronce/√Åmbar oscuro */
            --accent: #7f1d1d; /* Rojo Sangre Carmes√≠ */
            --accent-text: #fef3c7; /* Letra clara sobre rojo */
            --dock-bg: rgba(26, 11, 11, 0.9);
            --font-head: 'Cinzel', serif;
            --shadow: 0 8px 15px -3px rgba(180, 83, 9, 0.2);
        }

        /* Aplicaci√≥n de Variables */
        body { background-color: var(--bg-app); color: var(--text-main); font-family: -apple-system, sans-serif; transition: background-color 0.4s, color 0.4s; overflow: hidden; -webkit-tap-highlight-color: transparent;}
        h1, h2, h3, .font-epic { font-family: var(--font-head); transition: font-family 0.4s; }
        .card-bg { background-color: var(--bg-card); border: 1px solid var(--border-color); box-shadow: var(--shadow); transition: all 0.4s; }
        .input-bg { background-color: var(--bg-app); color: var(--text-main); border: 1px solid var(--border-color); transition: all 0.4s; }
        .input-bg:focus { border-color: var(--accent); outline: none; }
        .text-muted { color: var(--text-muted); }
        .btn-accent { background-color: var(--accent); color: var(--accent-text); border: 2px solid var(--border-color); box-shadow: var(--shadow); transition: all 0.2s; }
        .btn-accent:active { transform: scale(0.95); opacity: 0.9; }
        .dock-blur { background: var(--dock-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-top: 1px solid var(--border-color); }

        /* iPhone Safe Areas */
        .pt-safe { padding-top: env(safe-area-inset-top, 47px); }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 34px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .snap-x-mandatory { scroll-snap-type: x mandatory; }
        .snap-center { scroll-snap-align: center; }
        .preview-wrapper iframe { width: 100%; height: 50vh; border: none; border-radius: 12px; background: #fff; }
    </style>
</head>
<body class="flex flex-col h-screen pb-safe">

    <header class="pt-safe card-bg px-5 pb-3 z-20 shrink-0 flex justify-between items-end border-b-0 rounded-b-3xl">
        <div>
            <h1 class="text-2xl font-black tracking-tight" id="mainTitle">Mercado Limpio</h1>
            <p class="text-[10px] text-muted font-bold uppercase tracking-widest mt-1">Facturaci√≥n Express</p>
        </div>
        <div class="bg-emerald-500/20 text-emerald-500 border border-emerald-500/50 text-[10px] font-black px-2 py-1 rounded-full uppercase tracking-wide animate-pulse">Online</div>
    </header>

    <main class="flex-1 overflow-y-auto no-scrollbar pb-32 pt-4 px-4 space-y-4">
        
        <section id="tab-fast" class="space-y-4">
            
            <div class="card-bg rounded-3xl p-5">
                <h2 class="text-xs font-black text-muted uppercase tracking-widest mb-4">Datos Principales</h2>
                
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div>
                        <label class="block text-[10px] font-bold text-muted uppercase ml-1 mb-1">CUIT Cliente</label>
                        <input type="tel" id="fastCuit" inputmode="numeric" class="w-full input-bg rounded-xl p-3 text-lg font-bold text-center" placeholder="Sin guiones">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-muted uppercase ml-1 mb-1">Total (Con IVA)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3.5 font-black text-muted">$</span>
                            <input type="tel" id="fastMonto" inputmode="decimal" class="w-full input-bg rounded-xl p-3 pl-7 text-lg font-black text-right" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-[10px] font-bold text-muted uppercase ml-1 mb-1">M√©todo de Pago</label>
                    <select id="fastCondicion" class="w-full input-bg rounded-xl p-3 text-sm font-bold appearance-none">
                        <option value="Cuenta Corriente">Cuenta Corriente</option>
                        <option value="Otros: Para formas de pago no especificadas">Otros: No especificado</option>
                        <option value="Otros medios de pago electr√≥nicos">Otros medios electr√≥nicos</option>
                        <option value="Transferencia Bancaria">Transferencia Bancaria</option>
                        <option value="Efectivo">Efectivo</option>
                    </select>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-muted uppercase ml-1 mb-1">Descripci√≥n del Art√≠culo</label>
                    <input type="text" id="fastDesc" class="w-full input-bg rounded-xl p-3 text-sm font-bold mb-2" placeholder="Escriba el detalle...">
                    
                    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                        <button onclick="setDesc('ARTICULOS VARIOS MARCA MAKE DE LIMPIEZA Y BAZAR')" class="shrink-0 bg-transparent border border-current text-current opacity-70 hover:opacity-100 rounded-lg px-3 py-1.5 text-xs font-bold whitespace-nowrap active:scale-95 transition">
                            üì¶ Marca MAKE
                        </button>
                        <button onclick="pedirMarcaManual()" class="shrink-0 bg-transparent border border-current text-current opacity-70 hover:opacity-100 rounded-lg px-3 py-1.5 text-xs font-bold whitespace-nowrap active:scale-95 transition">
                            ‚úèÔ∏è Otra Marca...
                        </button>
                    </div>
                </div>
            </div>

            <div class="card-bg rounded-3xl p-4">
                <label class="block text-[10px] font-bold text-muted uppercase ml-1 mb-1">Email destino (Opcional)</label>
                <input type="email" id="fastEmail" class="w-full input-bg rounded-xl p-3 text-sm font-semibold" placeholder="distribuidoramercadolimpio@gmail.com">
            </div>

        </section>

        <section id="tab-capture" class="hidden space-y-4">
            <input type="file" id="inputPdf" accept="application/pdf" multiple class="hidden" />

            <div class="card-bg rounded-3xl p-6 text-center">
                <div class="text-4xl mb-4 opacity-80">üìÑ</div>
                <h3 class="font-epic text-lg font-bold mb-2">Procesar PDF</h3>
                <p class="text-xs text-muted mb-6">Si te enviaron el remito por WhatsApp, guardalo en Archivos y seleccionalo ac√° para procesarlo con IA.</p>
                <button onclick="document.getElementById('inputPdf').click()" class="btn-accent w-full py-4 rounded-xl font-black tracking-widest uppercase text-sm">
                    Seleccionar Archivo
                </button>
            </div>
            
            <div id="loaderUI" class="hidden card-bg rounded-2xl p-5 flex items-center justify-center gap-4 border-2 border-[var(--accent)] animate-pulse">
                <div class="font-epic font-bold text-sm">Analizando documento...</div>
            </div>
        </section>

        <section id="tab-preview" class="hidden flex flex-col h-full space-y-3">
            <div class="card-bg p-5 rounded-2xl shrink-0 border-2 border-[var(--accent)]">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-[10px] font-black text-muted uppercase tracking-widest">A Facturar</span>
                </div>
                <div class="flex items-baseline gap-2">
                    <span class="text-4xl font-epic font-black tracking-tighter" id="txtTotal">$0.00</span>
                </div>
            </div>
            
            <div class="w-full overflow-x-auto snap-x-mandatory no-scrollbar flex gap-3 pb-2 shrink-0" id="railPartes"></div>

            <div class="pb-5 flex-1 preview-wrapper" id="previewContainer">
                <iframe id="previewFrame" class="border-2 border-[var(--border-color)]"></iframe>
            </div>
        </section>

        <section id="tab-settings" class="hidden space-y-4">
            <div class="card-bg rounded-3xl p-6">
                <h2 class="text-sm font-epic font-black uppercase tracking-widest mb-6 border-b border-[var(--border-color)] pb-2">Apariencia de la App</h2>
                
                <div class="space-y-3">
                    <button onclick="setTheme('light')" class="w-full flex items-center justify-between p-4 rounded-xl border border-[var(--border-color)] active:scale-95 transition bg-gray-100 text-slate-800">
                        <span class="font-bold">‚òÄÔ∏è Modo Claro</span>
                    </button>
                    
                    <button onclick="setTheme('dark')" class="w-full flex items-center justify-between p-4 rounded-xl border border-[var(--border-color)] active:scale-95 transition bg-slate-800 text-white">
                        <span class="font-bold">üåô Modo Oscuro</span>
                    </button>
                    
                    <button onclick="setTheme('gladiator')" class="w-full flex items-center justify-between p-4 rounded-xl border border-[#78350f] active:scale-95 transition bg-[#1a0a0a] text-[#fcd34d]">
                        <span class="font-epic font-black tracking-widest">‚öîÔ∏è TEMA GLADIADOR</span>
                    </button>
                </div>
            </div>
        </section>

    </main>

    <div id="statusAlert" class="hidden fixed top-16 left-1/2 transform -translate-x-1/2 z-[100] rounded-full px-5 py-3 text-xs font-black shadow-2xl min-w-[80%] text-center transition-all duration-300"></div>

    <nav class="dock-blur fixed bottom-0 w-full pb-safe pt-2 px-6 flex justify-between items-center z-50 rounded-t-3xl">
        <button onclick="switchTab('fast')" id="nav-fast" class="flex flex-col items-center gap-1 w-12 text-[var(--accent)] transition-colors opacity-100">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            <span class="text-[8px] font-black uppercase tracking-widest">R√°pida</span>
        </button>
        
        <button onclick="switchTab('capture')" id="nav-capture" class="flex flex-col items-center gap-1 w-12 text-muted transition-colors opacity-60">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            <span class="text-[8px] font-black uppercase tracking-widest">PDFs</span>
        </button>

        <div class="relative -top-6">
            <button id="btnMainAction" onclick="procesarFastYVer()" class="btn-accent w-16 h-16 rounded-full flex flex-col items-center justify-center transform transition border-4 border-[var(--bg-app)]">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                <span class="text-[7px] font-black mt-1 uppercase tracking-widest" id="lblMainBtn">Generar</span>
            </button>
        </div>

        <button onclick="switchTab('preview')" id="nav-preview" class="flex flex-col items-center gap-1 w-12 text-muted transition-colors opacity-60">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
            <span class="text-[8px] font-black uppercase tracking-widest">Preview</span>
        </button>

        <button onclick="switchTab('settings')" id="nav-settings" class="flex flex-col items-center gap-1 w-12 text-muted transition-colors opacity-60">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
            <span class="text-[8px] font-black uppercase tracking-widest">Tema</span>
        </button>
    </nav>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => navigator.serviceWorker.register('sw.js').catch(()=>{}));
      }
    </script>
    <script src="app.js" defer></script>
</body>
</html>
