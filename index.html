<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
  />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0B1220" />

  <title>Mercado Limpio ‚Äî Facturaci√≥n</title>

  <!-- (Opcional PWA) -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1220;
      --card:#0F172A;
      --card2:#0B1020;
      --stroke: rgba(255,255,255,.08);
      --stroke2: rgba(255,255,255,.12);
      --text:#E6EAF2;
      --muted: rgba(230,234,242,.68);
      --muted2: rgba(230,234,242,.48);
      --accent:#5B8CFF;      /* azul */
      --accent2:#19D3C5;     /* turquesa */
      --danger:#FF4D6D;
      --ok:#22C55E;
      --warn:#FBBF24;
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --radius: 22px;
      --radius2: 16px;
      --tap: 52px; /* target t√°ctil */
      --font: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Helvetica,Arial,sans-serif;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(91,140,255,.35), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(25,211,197,.22), transparent 55%),
        radial-gradient(1200px 800px at 50% 110%, rgba(91,140,255,.18), transparent 65%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
      -webkit-tap-highlight-color: transparent;
    }

    /* safe areas */
    .pt-safe{ padding-top: env(safe-area-inset-top, 12px); }
    .pb-safe{ padding-bottom: env(safe-area-inset-bottom, 12px); }

    /* layout */
    .app{
      height:100%;
      display:flex;
      flex-direction:column;
    }

    header{
      position:sticky;
      top:0;
      z-index:30;
      padding: 14px 16px 10px 16px;
      padding-top: calc(14px + env(safe-area-inset-top, 12px));
      background: linear-gradient(180deg, rgba(7,10,18,.85), rgba(7,10,18,.45));
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-bottom: 1px solid var(--stroke);
    }

    .hrow{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .brand h1{
      margin:0;
      font-size: 20px;
      font-weight: 900;
      letter-spacing: -0.02em;
      line-height:1.05;
    }
    .brand .sub{
      font-size:11px;
      font-weight:800;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: var(--muted);
    }

    .badges{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .badge{
      font-size:10px;
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      user-select:none;
    }
    .badge.ok{ color: rgba(34,197,94,.95); border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.08); }
    .badge.bad{ color: rgba(255,77,109,.95); border-color: rgba(255,77,109,.35); background: rgba(255,77,109,.08); }
    .badge.draft{ color: rgba(251,191,36,.95); border-color: rgba(251,191,36,.35); background: rgba(251,191,36,.08); }

    main{
      flex:1;
      overflow:hidden;
      position:relative;
    }

    .screen{
      position:absolute;
      inset:0;
      overflow:auto;
      padding: 14px 14px 110px 14px;
      scrollbar-width:none;
    }
    .screen::-webkit-scrollbar{ display:none; }

    .hidden{ display:none !important; }

    /* transitions between tabs */
    .screen{
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .screen.active{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    /* cards */
    .card{
      background: linear-gradient(180deg, rgba(15,23,42,.92), rgba(15,23,42,.82));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 16px;
    }
    .card.soft{
      box-shadow: 0 10px 30px rgba(0,0,0,.24);
    }
    .sectionTitle{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:10px;
    }
    .sectionTitle .t{
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.16em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .sectionTitle .hint{
      font-size:11px;
      font-weight:800;
      color: var(--muted2);
    }

    /* buttons */
    .btn{
      height: var(--tap);
      border-radius: 18px;
      border: 1px solid var(--stroke2);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight: 900;
      letter-spacing: -.01em;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 0 14px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .12s ease, background .12s ease, opacity .12s ease;
    }
    .btn:active{ transform: scale(.98); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    .btn.primary{
      border-color: rgba(91,140,255,.40);
      background: linear-gradient(135deg, rgba(91,140,255,.95), rgba(25,211,197,.72));
      box-shadow: 0 18px 45px rgba(91,140,255,.22);
    }
    .btn.dark{
      border-color: rgba(255,255,255,.10);
      background: rgba(255,255,255,.07);
    }
    .btn.ghost{
      background: rgba(255,255,255,.03);
      border-color: rgba(255,255,255,.08);
    }
    .btn.danger{
      border-color: rgba(255,77,109,.35);
      background: rgba(255,77,109,.14);
      color: rgba(255,77,109,.95);
    }
    .btn.ok{
      border-color: rgba(34,197,94,.35);
      background: rgba(34,197,94,.14);
      color: rgba(34,197,94,.95);
    }

    .btnIcon{
      width: 24px; height: 24px; display:inline-flex; align-items:center; justify-content:center;
      border-radius: 10px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.10);
    }
    .btn.primary .btnIcon{ background: rgba(0,0,0,.18); border-color: rgba(0,0,0,.10); }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .grid3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; }

    /* inputs */
    .field{ display:flex; flex-direction:column; gap:8px; }
    label{
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: var(--muted);
    }
    input, select{
      height: 54px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      outline:none;
      background: rgba(0,0,0,.18);
      color: var(--text);
      font-size: 16px;
      font-weight: 900;
      padding: 0 14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }
    input::placeholder{ color: rgba(230,234,242,.35); font-weight:800; }
    select{ font-weight:900; }

    .helper{
      font-size: 12px;
      color: var(--muted2);
      line-height:1.4;
      font-weight:700;
    }
    .ol{
      margin:10px 0 0 18px;
      padding:0;
      color: var(--muted);
      font-size: 13px;
      font-weight:700;
      line-height:1.45;
    }
    .ol li{ margin: 6px 0; }

    /* items list */
    .list{ display:flex; flex-direction:column; gap:10px; }
    .item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
    }
    .item .left{ min-width:0; }
    .item .desc{
      font-size: 14px;
      font-weight: 950;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-bottom: 2px;
    }
    .item .meta{
      font-size: 12px;
      font-weight: 800;
      color: var(--muted);
    }
    .item .right{
      display:flex;
      align-items:center;
      gap:10px;
      flex-shrink:0;
    }
    .money{
      font-size: 14px;
      font-weight: 950;
      letter-spacing:-.01em;
    }
    .mini{
      height: 44px;
      border-radius: 16px;
      padding: 0 12px;
      font-size: 13px;
      font-weight: 950;
    }

    /* preview */
    .summary{
      padding: 16px;
      border-radius: var(--radius);
      background: linear-gradient(135deg, rgba(91,140,255,.20), rgba(25,211,197,.10));
      border: 1px solid rgba(91,140,255,.18);
      box-shadow: 0 18px 55px rgba(0,0,0,.28);
    }
    .sumTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 8px;
    }
    .chip{
      font-size:10px;
      font-weight:950;
      letter-spacing:.12em;
      text-transform:uppercase;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      color: var(--muted);
    }
    .chip.ok{ border-color: rgba(34,197,94,.30); background: rgba(34,197,94,.10); color: rgba(34,197,94,.95); }
    .chip.warn{ border-color: rgba(251,191,36,.30); background: rgba(251,191,36,.10); color: rgba(251,191,36,.95); }
    .totalRow{
      display:flex;
      align-items:baseline;
      gap:10px;
    }
    .total{
      font-size: 34px;
      font-weight: 1000;
      letter-spacing:-.03em;
    }
    .strike{
      font-size: 14px;
      font-weight: 900;
      color: rgba(230,234,242,.55);
      text-decoration: line-through;
    }

    .rail{
      display:flex;
      gap:10px;
      overflow:auto;
      padding-bottom: 4px;
      scroll-snap-type: x mandatory;
      scrollbar-width:none;
    }
    .rail::-webkit-scrollbar{ display:none; }
    .railCard{
      flex: 0 0 56%;
      scroll-snap-align:center;
      border-radius: 20px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      cursor:pointer;
      user-select:none;
      transition: transform .10s ease, background .12s ease, border-color .12s ease;
    }
    .railCard:active{ transform: scale(.985); }
    .railCard.active{
      border-color: rgba(91,140,255,.45);
      background: rgba(91,140,255,.14);
    }
    .railCard .top{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .railCard .p1{
      font-size: 11px; font-weight: 950; letter-spacing:.14em; text-transform:uppercase; color: rgba(91,140,255,.95);
    }
    .dot{ width:10px; height:10px; border-radius:999px; background: rgba(255,255,255,.16); }
    .railCard.active .dot{ background: rgba(91,140,255,.95); }
    .railCard .p2{ margin-top:8px; font-size:12px; font-weight:900; color: var(--muted); }

    .frameWrap{
      margin-top: 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
      background: rgba(0,0,0,.18);
      min-height: 52vh;
      position:relative;
    }
    iframe{
      width:100%;
      height: 52vh;
      border:0;
      background:#fff;
      display:block;
    }
    .frameLoading{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      opacity:0;
      pointer-events:none;
      transition: opacity .14s ease;
    }
    .frameWrap.loading .frameLoading{
      opacity:1;
      pointer-events:auto;
    }

    /* bottom nav */
    nav{
      position:fixed;
      left:0; right:0; bottom:0;
      z-index:50;
      padding: 10px 14px;
      padding-bottom: calc(10px + env(safe-area-inset-bottom, 12px));
      background: linear-gradient(180deg, rgba(7,10,18,.30), rgba(7,10,18,.85));
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-top: 1px solid var(--stroke);
    }
    .dock{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .navBtn{
      height: 56px;
      min-width: 72px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:4px;
      color: var(--muted);
      font-weight:950;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, background .12s ease, border-color .12s ease, color .12s ease;
    }
    .navBtn:active{ transform: scale(.985); }
    .navBtn.active{
      color: var(--text);
      border-color: rgba(91,140,255,.45);
      background: rgba(91,140,255,.12);
    }
    .navBtn span{ font-size: 10px; letter-spacing:.14em; text-transform:uppercase; }

    .fabWrap{
      transform: translateY(-14px);
      display:flex;
      justify-content:center;
      align-items:center;
      min-width: 86px;
    }
    .fab{
      width: 76px;
      height: 76px;
      border-radius: 999px;
      border: 4px solid rgba(7,10,18,.92);
      background: linear-gradient(135deg, rgba(91,140,255,.95), rgba(25,211,197,.80));
      box-shadow: 0 22px 60px rgba(91,140,255,.25);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:4px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .12s ease;
    }
    .fab:active{ transform: scale(.96); }
    .fab .lbl{ font-size:10px; font-weight:1000; letter-spacing:.14em; text-transform:uppercase; color: rgba(0,0,0,.75); }

    /* toast */
    .toast{
      position:fixed;
      top: calc(10px + env(safe-area-inset-top, 12px));
      left:50%;
      transform: translateX(-50%);
      z-index:100;
      max-width: min(560px, 92vw);
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(15,23,42,.88);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      font-weight: 950;
      font-size: 13px;
      letter-spacing:-.01em;
      opacity:0;
      pointer-events:none;
      transition: opacity .14s ease, transform .14s ease;
    }
    .toast.show{
      opacity:1;
      pointer-events:auto;
      transform: translateX(-50%) translateY(4px);
    }
    .toast.ok{ border-color: rgba(34,197,94,.28); }
    .toast.bad{ border-color: rgba(255,77,109,.28); }
    .toast.info{ border-color: rgba(91,140,255,.28); }

    /* global loading overlay */
    .overlay{
      position:fixed; inset:0;
      z-index:120;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.32);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      opacity:0;
      pointer-events:none;
      transition: opacity .14s ease;
    }
    .overlay.show{ opacity:1; pointer-events:auto; }
    .loaderCard{
      width: min(520px, 92vw);
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(15,23,42,.92);
      box-shadow: 0 22px 70px rgba(0,0,0,.45);
      padding: 16px;
    }
    .spinRow{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .spinner{
      width: 28px; height: 28px;
      border-radius: 999px;
      border: 3px solid rgba(255,255,255,.18);
      border-top-color: rgba(91,140,255,.95);
      animation: spin 1s linear infinite;
      flex-shrink:0;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loaderTitle{ font-size: 14px; font-weight: 1000; }
    .loaderSub{ font-size: 12px; font-weight: 850; color: var(--muted); margin-top:2px; }
    .steps{
      margin-top: 12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .step{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
    }
    .step.on{ color: var(--text); border-color: rgba(91,140,255,.22); background: rgba(91,140,255,.10); }
    .step .k{ font-weight:1000; }

    /* bottom sheet modal */
    .sheet{
      position:fixed;
      inset:0;
      z-index:200;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding: 12px;
      padding-bottom: calc(12px + env(safe-area-inset-bottom, 12px));
      opacity:0;
      pointer-events:none;
      transition: opacity .14s ease;
    }
    .sheet.show{ opacity:1; pointer-events:auto; }
    .sheet .backdrop{
      position:absolute; inset:0;
      background: rgba(0,0,0,.48);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .sheet .panel{
      position:relative;
      width: min(560px, 96vw);
      border-radius: 28px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(15,23,42,.96);
      box-shadow: 0 26px 90px rgba(0,0,0,.55);
      padding: 14px;
      transform: translateY(18px);
      transition: transform .14s ease;
    }
    .sheet.show .panel{ transform: translateY(0); }

    .sheetTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 6px 4px 10px 4px;
    }
    .grab{
      width: 44px; height: 5px;
      border-radius: 999px;
      background: rgba(255,255,255,.16);
      margin: 0 auto 10px auto;
    }
    .sheetTitle{
      font-size: 12px;
      font-weight: 1000;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: var(--muted);
    }
    .sheetH{
      font-size: 16px;
      font-weight: 1000;
      letter-spacing:-.02em;
      margin-top: 3px;
    }

    /* result cards */
    .resultList{ display:flex; flex-direction:column; gap:10px; margin-top:12px; }
    .res{
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      padding: 12px;
    }
    .resTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      font-size: 12px; font-weight: 950;
      color: var(--muted);
      letter-spacing:.10em; text-transform:uppercase;
    }
    .resMid{
      margin-top: 6px;
      display:flex; justify-content:space-between; align-items:baseline; gap:10px;
    }
    .resMid .n{ font-size: 15px; font-weight: 1000; }
    .resMid .v{ font-size: 15px; font-weight: 1000; }
    .resBtns{ margin-top: 10px; display:flex; gap:10px; }

    /* small text */
    .empty{
      padding: 14px;
      border-radius: 18px;
      border:1px dashed rgba(255,255,255,.14);
      color: var(--muted);
      text-align:center;
      font-weight: 850;
      font-size: 13px;
    }

    /* reduce motion support */
    @media (prefers-reduced-motion: reduce){
      .screen, .toast, .overlay, .sheet, .sheet .panel, .btn, .navBtn, .fab { transition:none !important; }
      .spinner{ animation:none !important; }
    }
  </style>
</head>

<body>
  <div class="app">

    <header>
      <div class="hrow">
        <div class="brand">
          <h1>Mercado Limpio</h1>
          <div class="sub">Facturaci√≥n ARCA ¬∑ PRO</div>
        </div>

        <div class="badges">
          <div id="badgeDraft" class="badge draft hidden">Borrador</div>
          <div id="badgeOnline" class="badge">Verificando‚Ä¶</div>
        </div>
      </div>
    </header>

    <main>

      <!-- CAPTURE -->
      <section id="screen-capture" class="screen active">
        <input id="inputPdf" type="file" accept="application/pdf" multiple class="hidden"/>

        <div class="card soft">
          <div class="sectionTitle">
            <div class="t">Opci√≥n 1</div>
            <div class="hint">PDF / WhatsApp</div>
          </div>

          <div style="font-size:15px;font-weight:1000;letter-spacing:-.02em;margin-bottom:6px;">
            Procesar remito PDF
          </div>
          <div class="helper">
            Extrae √≠tems con tu backend (IA + regex), arma el borrador, y te deja listo para emitir.
          </div>

          <ol class="ol">
            <li>Abr√≠ el PDF desde WhatsApp.</li>
            <li>Compartir ‚Üí Guardar en Archivos.</li>
            <li>Volv√© ac√° y toc√° ‚ÄúProcesar PDF‚Äù.</li>
          </ol>

          <div style="height:12px;"></div>
          <div class="grid2">
            <button id="btnPickPdf" class="btn primary">
              <span class="btnIcon">üìÑ</span>
              Procesar PDF
            </button>
            <button id="btnGoManual" class="btn dark">
              <span class="btnIcon">‚úçÔ∏è</span>
              Manual
            </button>
          </div>
        </div>

        <div style="height:14px;"></div>

        <div class="card">
          <div class="sectionTitle">
            <div class="t">Opci√≥n 2</div>
            <div class="hint">Carga r√°pida</div>
          </div>
          <div style="font-size:15px;font-weight:1000;letter-spacing:-.02em;margin-bottom:6px;">
            Factura manual
          </div>
          <div class="helper">
            Carg√°s CUIT + √≠tems manuales. El backend consulta padr√≥n y genera PDFs + link WhatsApp.
          </div>

          <div style="height:12px;"></div>
          <button id="btnGoManual2" class="btn ghost" style="width:100%;">
            <span class="btnIcon">‚û°Ô∏è</span>
            Ir a Manual
          </button>
        </div>
      </section>

      <!-- DATA -->
      <section id="screen-data" class="screen">
        <div class="card soft">
          <div class="sectionTitle">
            <div class="t">Cliente</div>
            <div class="hint">CUIT + domicilio + venta</div>
          </div>

          <div class="field">
            <label for="cuit">CUIT (11 n√∫meros)</label>
            <input id="cuit" inputmode="numeric" type="text" placeholder="20123456789" />
          </div>

          <div style="height:12px;"></div>

          <div class="field">
            <label for="domicilioRemito">Domicilio (opcional)</label>
            <input id="domicilioRemito" type="text" placeholder="Calle 123, Localidad" />
          </div>

          <div style="height:12px;"></div>

          <div class="field">
            <label for="condicionVenta">Condici√≥n de venta</label>
            <select id="condicionVenta">
              <option value="Transferencia Bancaria">Transferencia</option>
              <option value="Efectivo">Efectivo</option>
            </select>
          </div>
        </div>

        <div style="height:14px;"></div>

        <div class="card">
          <div class="sectionTitle">
            <div class="t">Art√≠culos</div>
            <div class="hint"><span id="itemCount">0</span> √≠tems</div>
          </div>

          <div style="display:flex; gap:10px; margin-bottom:10px;">
            <button id="btnAddItem" class="btn primary mini" style="flex:1;">
              <span class="btnIcon">Ôºã</span>
              Agregar
            </button>
            <button id="btnClearItems" class="btn ghost mini">
              üßπ Limpiar
            </button>
          </div>

          <div id="itemsList" class="list">
            <div class="empty">Proces√° un PDF o carg√° √≠tems manuales.</div>
          </div>

          <div style="height:12px;"></div>
          <div class="grid3">
            <button id="btnRecalc" class="btn ghost">‚Üª Totales</button>
            <button id="btnGoManualFromData" class="btn ghost">‚úçÔ∏è Manual</button>
            <button id="btnGoPreview" class="btn dark">üëÅÔ∏è Borrador</button>
          </div>
        </div>

        <div style="height:14px;"></div>

        <div class="card">
          <div class="sectionTitle">
            <div class="t">Descuento</div>
            <div class="hint">opcional</div>
          </div>
          <div class="grid2">
            <div class="field">
              <label for="descuentoPct">%</label>
              <input id="descuentoPct" inputmode="decimal" type="text" placeholder="0" />
            </div>
            <div class="field">
              <label for="descuentoImporte">$</label>
              <input id="descuentoImporte" inputmode="decimal" type="text" placeholder="0" />
            </div>
          </div>
          <div class="helper" style="margin-top:10px;">
            Si complet√°s <b>importe</b>, manda sobre %. Si complet√°s %, recalcula total.
          </div>
        </div>
      </section>

      <!-- MANUAL -->
      <section id="screen-manual" class="screen">
        <div class="card soft">
          <div class="sectionTitle">
            <div class="t">Manual</div>
            <div class="hint">carga por √≠tem</div>
          </div>

          <div style="font-size:16px;font-weight:1000;letter-spacing:-.02em;margin-bottom:6px;">
            Factura manual (r√°pida)
          </div>
          <div class="helper">
            Agreg√° √≠tems ac√°. Si quer√©s editar CUIT, domicilio o descuento: and√° a ‚ÄúDatos‚Äù.
          </div>

          <div style="height:12px;"></div>
          <div class="grid2">
            <button id="btnManualAddItem" class="btn primary">
              <span class="btnIcon">Ôºã</span>
              Agregar √≠tem
            </button>
            <button id="btnManualGoData" class="btn dark">
              <span class="btnIcon">‚â°</span>
              Ir a Datos
            </button>
          </div>

          <div style="height:12px;"></div>

          <div class="summary">
            <div class="sumTop">
              <div class="chip">Total estimado</div>
              <div class="chip warn hidden" id="chipDescManual">Descuento</div>
            </div>
            <div class="totalRow">
              <div class="total" id="txtTotalManual">$0,00</div>
              <div class="strike hidden" id="txtSubtotalManual">$0,00</div>
            </div>
          </div>

          <div style="height:12px;"></div>
          <button id="btnManualGoPreview" class="btn ghost" style="width:100%;">
            üëÅÔ∏è Ver borrador
          </button>
        </div>

        <div style="height:14px;"></div>

        <div class="card">
          <div class="sectionTitle">
            <div class="t">√çtems</div>
            <div class="hint"><span id="itemCountManual">0</span> √≠tems</div>
          </div>

          <div id="itemsListManual" class="list">
            <div class="empty">Agreg√° √≠tems para emitir manual.</div>
          </div>
        </div>
      </section>

      <!-- PREVIEW -->
      <section id="screen-preview" class="screen">
        <div class="summary">
          <div class="sumTop">
            <div class="chip">Resumen</div>
            <div id="chipDescPct" class="chip ok hidden">DESC 0%</div>
          </div>
          <div class="totalRow">
            <div class="total" id="txtTotal">$0,00</div>
            <div class="strike hidden" id="txtSubtotal">$0,00</div>
          </div>

          <div style="height:12px;"></div>
          <div class="grid2">
            <button id="btnEmitir" class="btn primary">
              <span class="btnIcon">‚ö°</span>
              Emitir
            </button>
            <button id="btnResetDraft" class="btn danger">
              ‚ôªÔ∏è Nuevo
            </button>
          </div>
        </div>

        <div style="height:14px;"></div>

        <div class="card">
          <div class="sectionTitle">
            <div class="t">Partes</div>
            <div class="hint">preview backend</div>
          </div>

          <div id="railPartes" class="rail"></div>

          <div class="frameWrap" id="frameWrap">
            <div class="frameLoading">
              <div class="spinner" aria-hidden="true"></div>
            </div>
            <iframe id="previewFrame" title="Preview"></iframe>
          </div>

          <div id="resultBox" class="hidden" style="margin-top:12px;">
            <div class="sectionTitle" style="margin-bottom:8px;">
              <div class="t">Resultado</div>
              <button id="btnShareWa" class="btn ok mini">üì≤ WhatsApp</button>
            </div>
            <div class="helper" id="resultTitle" style="font-weight:950;color:var(--text);margin-bottom:8px;">
              Factura emitida
            </div>
            <div id="resultList" class="resultList"></div>
          </div>
        </div>
      </section>

    </main>

    <nav>
      <div class="dock">
        <button id="navCapture" class="navBtn active" data-screen="capture">
          <div>üè†</div><span>Inicio</span>
        </button>

        <button id="navData" class="navBtn" data-screen="data">
          <div>‚â°</div><span>Datos</span>
        </button>

        <div class="fabWrap">
          <button id="btnMainAction" class="fab" aria-label="Acci√≥n principal">
            <div style="font-size:22px;">üìÑ</div>
            <div class="lbl" id="btnMainLabel">Procesar</div>
          </button>
        </div>

        <button id="navPreview" class="navBtn" data-screen="preview">
          <div>üëÅÔ∏è</div><span>Borrador</span>
        </button>

        <button id="btnShareNative" class="navBtn">
          <div>üì§</div><span>Enviar</span>
        </button>
      </div>
    </nav>

    <!-- TOAST -->
    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <!-- GLOBAL OVERLAY -->
    <div id="overlay" class="overlay" aria-hidden="true">
      <div class="loaderCard">
        <div class="spinRow">
          <div class="spinner" aria-hidden="true"></div>
          <div>
            <div id="overlayTitle" class="loaderTitle">Procesando‚Ä¶</div>
            <div id="overlaySub" class="loaderSub">Un segundo‚Ä¶</div>
          </div>
        </div>
        <div class="steps">
          <div class="step" id="st1"><span class="k">1</span> Subiendo / leyendo</div>
          <div class="step" id="st2"><span class="k">2</span> Extrayendo √≠tems</div>
          <div class="step" id="st3"><span class="k">3</span> Generando preview</div>
          <div class="step" id="st4"><span class="k">4</span> Emitiendo (ARCA + PDF)</div>
        </div>
      </div>
    </div>

    <!-- ITEM SHEET -->
    <div id="sheetItem" class="sheet" aria-hidden="true">
      <div class="backdrop" id="sheetBackdrop"></div>
      <div class="panel">
        <div class="grab"></div>

        <div class="sheetTop">
          <div>
            <div class="sheetTitle">√çtem</div>
            <div id="sheetH" class="sheetH">Agregar √≠tem</div>
          </div>
          <button id="btnCloseSheet" class="btn ghost mini">Cerrar</button>
        </div>

        <div class="card" style="box-shadow:none;background:rgba(0,0,0,.14);border-color:rgba(255,255,255,.08);">
          <div class="field">
            <label for="m_desc">Descripci√≥n</label>
            <input id="m_desc" type="text" placeholder="Ej: Detergente 5L" />
          </div>

          <div style="height:12px;"></div>

          <div class="grid2">
            <div class="field">
              <label for="m_qty">Cantidad</label>
              <input id="m_qty" inputmode="decimal" type="text" placeholder="1" />
            </div>
            <div class="field">
              <label for="m_unit">Precio unit c/IVA</label>
              <input id="m_unit" inputmode="decimal" type="text" placeholder="0" />
            </div>
          </div>

          <div style="height:12px;"></div>

          <div class="grid2">
            <button id="btnDeleteItem" class="btn danger hidden">üóëÔ∏è Eliminar</button>
            <button id="btnSaveItem" class="btn primary">‚úÖ Guardar</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // (Opcional PWA)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(() => {});
      });
    }
  </script>
  <script src="./app.js" defer></script>
</body>
</html>
